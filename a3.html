<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<!-- Design by Design Profesionals  Released for free under a Creative Commons Attribution 2.5 License Title : Essence Version : 1.0 Released : 20110518 Description: A two-column fixed-width template. Suitable for blogs and small business websites. -->
<meta http-equiv="content-type" content="text/html; charset=utf-8" /><title>Computational Photography MENG Zhixiang</title>

<link href="default.css" rel="stylesheet" type="text/css" />

<!-- Image Preloader -->
<script src="jquery.min.js"></script>

</head>
<script>
$(document).ready(function(){
	setInterval(function(){
		if(window.scrollY>=300){
			$('#updates').css('top',0);
			$('#updates').css('width',200);
			$('#updates').css('position','fixed');
		}
		else{
			$('#updates').css('position','static');
		}
	},100)
})
</script>

<body><div id="mask"></div><table id="pic_div" style="z-index:910; width:100%; height:100%; text-align:center; display:none;position:fixed;"><tr><td style="width:100%;  text-align:center; background:none;" id="mask_"><img id="pic_img" style=" max-height:500px; border-style:solid; border-color:#FFF; border-width:thick"></td></tr></table>
<table id="readme" style="z-index:910; width:100%; height:100%; display:none;position:fixed;"><tr><td style="width:100%;background:none;x;" id="mask_1"><div style="width:270px; height:170px; background-color:#FFF; padding:40px; margin:auto; line-height:35px"><h2>CSCI3290 Report</h2><p style=" line-height:40p">Available pages:<br>
<ul>
<li>index (pc/mobile)</li>
<li>registration (pc/mobile)</li>
</ul>All functionalities are disabled</p></div></td></tr></table>
<script>
$(document).ready(function(){
$('img').click(function(){
	$('body').css('overflow','hidden');
	$('#mask').show();
	$('#pic_img').attr('src',$(this).attr('src'));
	$('#pic_div').fadeIn(200);	
})
$('#mask_').click(function(){
	$('#pic_div').hide();
	$('#mask').hide();
	$('body').css('overflow','scroll');
	//$('#outer').css('overflow','scroll');
})
$('#mask_1').click(function(){
	$('#readme').hide();
	$('#mask').hide();
	$('body').css('overflow','scroll');
	//$('#outer').css('overflow','scroll');
})
})
function readme(){
	$('body').css('overflow','hidden');
	$('#mask').show();
	$('#readme').fadeIn(200);	
}
</script>
<div id="fb-root"></div>

<div id="header">
<h1 style="color: white">Computational Photography</h1>
<h2 style="color: white">MENG Zhixiang 1155029015</h2>
</div>
<div id="page">
<div id="content">
<div  class="post" style=" border-bottom:none">
	<h1 class="title" id="objective">Objective</h1>
	<div class="content">
	<p style="text-align:justify" >This project is to use a bunch of LDR images under different exposures to recover the radiance map and then construct a HDR image. Different construction algorithms are implemented and compared.</p>
	<img src="images/a3_images/case1/belg001.jpg" alt="" class="photo" style="width: 30%; height: auto" />
	<img src="images/a3_images/case1/belg002.jpg" alt="" class="photo" style="width: 30%; height: auto" />
	<img src="images/a3_images/case1/belg003.jpg" alt="" class="photo" style="width: 30%; height: auto" />
	<img src="images/a3_images/case1/belg004.jpg" alt="" class="photo" style="width: 30%; height: auto" />
	<img src="images/a3_images/case1/belg005.jpg" alt="" class="photo" style="width: 30%; height: auto" />
	<img src="images/a3_images/case1/belg006.jpg" alt="" class="photo" style="width: 30%; height: auto" />
	<img src="images/a3_images/case1/belg007.jpg" alt="" class="photo" style="width: 30%; height: auto" />
	<img src="images/a3_images/case1/belg008.jpg" alt="" class="photo" style="width: 30%; height: auto" />
	<img src="images/a3_images/case1/belg009.jpg" alt="" class="photo" style="width: 30%; height: auto" />
</div></div>
<div  class="post" style=" border-bottom:none">
	<h1 class="title" id="radiance">Radiance Map Construction</h1>
	<div class="content">
	<p style="text-align:justify" >To construct a HDR image, we need to recover the radiance map first, which is a function mapping real-world radiance values to RGB values between 0 and 255. Using a bunch of images under different exposures, we know that, for each pixel, the radiance value is constant through the images, but only exposure time is changing, resulting in different RGB values. Therefore, we can select a bunch of pixels and use their constant radiance value and different RBG values in different images to construct the map from radiance values to RGB values. Here, we randomly select N pixels for R/G/B channel respectively. To smooth the curve, we add a smooth term with parameter lamda. Seen from the maps below, we can clearly see that the curve becomes smoother as N increase. More pixels are needed, however, as the pixels are randomly selected and the result can be very unstable if too few pixels are selected. And as lamda increases, the curve first becomes more smooth but then less smooth. (All the radiance maps are recovered based on the nine pictures above)</p>
	<table border="1pt" style="float: center; text-align: center;" >
	<tr>
	<td>N = 10</td>
	<td>N = 50</td>
	<td>N = 100</td>
	</tr>
	<tr>
	<td><img src="images/a3_images/radmap/rad_map_10_0.2.png" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/radmap/rad_map_50_0.2.png" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/radmap/rad_map_100_0.2.png" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	<tr>
	<td>N = 200</td>
	<td>N = 300</td>
	<td>N = 500</td>
	</tr>
	<tr>
	<td><img src="images/a3_images/radmap/rad_map_200_0.2.png" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/radmap/rad_map_300_0.2.png" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/radmap/rad_map_500_0.2.png" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	</table>

	<table border="1pt" style="float: center; text-align: center;" >
	<tr>
	<td>lamda = 0.001</td>
	<td>lamda = 0.01</td>
	<td>lamda = 0.1</td>
	</tr>
	<tr>
	<td><img src="images/a3_images/radmap/rad_map_300_0.001.png" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/radmap/rad_map_300_0.01.png" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/radmap/rad_map_300_0.1.png" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	<tr>
	<td>lamda = 0.2</td>
	<td>lamda = 0.3</td>
	<td>lamda = 0.4</td>
	</tr>
	<tr>
	<td><img src="images/a3_images/radmap/rad_map_300_0.2.png" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/radmap/rad_map_300_0.3.png" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/radmap/rad_map_300_0.4.png" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	</table>

</div></div>
<div  class="post" style=" border-bottom:none">
	<h1 class="title" id="global">Global Tone Mapping</h1>
	<div class="content">
	<p style="text-align:justify" >After we get the radiance map curve, we can easily calculate the real radiance value for each pixel. However, these values need to be mapped to the interval [0, 255] so that it can be stored as a digital image. One way to do so is to use some simple global operators, like L/(1+L), log(L) and so on. In some case, these operators appear to work well but generally the results are not that satisfying. Many details are missing or unclear, especially for the bright regions.</p>
	<img src="images/a3_images/global/belg_output_global_1.jpg" alt="" class="photo" style="width: 47%; height: auto" />
	<img src="images/a3_images/global/belg_output_global_2.jpg" alt="" class="photo" style="width: 47%; height: auto" />
	<img src="images/a3_images/global/memorial_output_global_1.jpg" alt="" class="photo" style="width: 47%; height: auto" />
	<img src="images/a3_images/global/memorial_output_global_2.jpg" alt="" class="photo" style="width: 47%; height: auto" />
	<img src="images/a3_images/global/29_output_global_1.jpg" alt="" class="photo" style="width: 47%; height: auto" />
	<img src="images/a3_images/global/29_output_global_2.jpg" alt="" class="photo" style="width: 47%; height: auto" />
	
</div></div>
<div  class="post" style=" border-bottom:none">
	<h1 class="title" id="local">Local Tone Mapping</h1>
	<div class="content">
	<p style="text-align:justify" >To improve the tone mapping results, more delicate algorithms are needed. Here we use a local tone mapping algorithm, referring to [Fast Bilateral Filtering for the Display of High-Dynamic-Range Images], which uses a bilateral filter to reduce noises and computes a detail layer to better keep the edges. We can see that the results are generally better than those of global tone mapping.</p>
	<table border="1pt" style="float: center; text-align: center;" >
	<tr>
	<td>Detail Layer</td>
	<td>Local Tone Mapping Result</td>
	<td>Global Tone Mapping Result</td>
	</tr>
	<tr>
	<td><img src="images/a3_images/detail/belg_detail_layer.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/local/belg_output_local.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/global/belg_output_global_1.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	<tr>
	<td><img src="images/a3_images/detail/memorial_detail_layer.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/local/memorial_output_local.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/global/memorial_output_global_1.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	<tr>
	<td><img src="images/a3_images/detail/29_detail_layer.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/local/29_output_local.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/global/29_output_global_1.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	</table>
	<p style="text-align:justify" >Here are more examples. In these examples, the reults of global tone mapping looks darker, instead of brighter. It may be due to the original image are dark, intead of bright, roughly speaking. But still, results of local tone mapping present more details in a better way.</p>
	<table border="1pt" style="float: center; text-align: center;" >
	<tr>
	<td>Detail Layer</td>
	<td>Local Tone Mapping Result</td>
	<td>Global Tone Mapping Result</td>
	</tr>
	<tr>
	<td><img src="images/a3_images/detail/table_detail_layer.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/local/table_output_local.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/global/table_output_global.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	<tr>
	<td><img src="images/a3_images/detail/garage_detail_layer.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/local/garage_output_local.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/global/garage_output_global.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	</table>

</div></div>
<div  class="post" style=" border-bottom:none">
	<h1 class="title" id="intensity">Intensity Calculation</h1>
	<div class="content">
	<p style="text-align:justify" >Among results generated above, it's not that stable, sometimes one channel of R/G/B in result image will be more obvious, leaving the whole image too 'red' or 'green'. To further improve the results, we calculate the intensity using linear combination of R/G/B channels instead of simply averaging them. Here are the comparisons. First of all, the results become more stable. And we can see that in some cases, it really works and the result looks better.</p>
	<table border="1pt" style="float: center; text-align: center;" >
	<tr>
	<td>Results with Average Intensity</td>
	<td>Results with Linear Combination of Intensity</td>
	</tr>
	<tr>
	<td><img src="images/a3_images/local/belg_output_local_w.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/linear/belg_output_local_linear.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	<tr>
	<td><img src="images/a3_images/local/memorial_output_local.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/linear/memorial_output_local_linear.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	<tr>
	<td><img src="images/a3_images/local/29_output_local.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/linear/29_output_local_linear.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	<tr>
	<td><img src="images/a3_images/local/table_output_local.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/linear/table_output_local_linear.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	<tr>
	<td><img src="images/a3_images/local/garage_output_local_w.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/linear/garage_output_local_linear.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	</table>

</div></div>
<div  class="post" style=" border-bottom:none">
	<h1 class="title" id="number">Using Different Number of Images</h1>
	<div class="content">
	<p style="text-align:justify">In discussion above, the results are generated based on a whole sequence of source images under different exposures. Afterwards, we re-construct the HDR image by using part of the source images. Here, we sort the images based on exposure time, and then generate the HDR image based on No. 1/3/5/7/9 images (1/2 images), No. 1/5/9 images (1/4 images), No. 1/2/3/4/5 (darker 1/2), No. 3/4/5/6/7 (middle 1/2) and No. 5/6/7/8/9 (bright 1/2) respectively. We can see that if we choose images evenly, the result of 1/2 images still looks quite good. But if we further choose fewer images, the result looks horrible as the radiance map can't be well recovered. And if we choose darker/brighter 1/2 images, the result will look darker/brighter. Besides, if we choose middle/brighter images, there will be some pixels information missing, as those pixels can only be seen clearly in darker images.</p>
	<table border="1pt" style="float: center; text-align: center;" >
	<tr>
	<td>Use All Images</td>
	<td>Use 1/2 Images</td>
	<td>Use 1/4 Images</td>
	</tr>
	<tr>
	<td><img src="images/a3_images/local/belg_output_local.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/fewer/belg_output_local_fewer5.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/fewer/belg_output_local_fewer3.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	<tr>
	<td>Use Darker 1/2 Images</td>
	<td>Use Middle 1/2 Images</td>
	<td>Use Brighter 1/4 Images</td>
	</tr>
	<tr>
	<td><img src="images/a3_images/fewer/belg_output_local_lower5.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/fewer/belg_output_local_middle5.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/fewer/belg_output_local_lighter5.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	</table>
	<p style="text-align:justify">Similarly processing other sets of source images, we get similar results.</p>
	<table border="1pt" style="float: center; text-align: center;" >
	<tr>
	<td>Use All Images</td>
	<td>Use 1/2 Images</td>
	<td>Use 1/4 Images</td>
	</tr>
	<tr>
	<td><img src="images/a3_images/local/memorial_output_local.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/fewer/memorial_output_local_fewer8.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/fewer/memorial_output_local_fewer4.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	<tr>
	<td>Use Darker 1/2 Images</td>
	<td>Use Middle 1/2 Images</td>
	<td>Use Brighter 1/4 Images</td>
	</tr>
	<tr>
	<td><img src="images/a3_images/fewer/memorial_output_local_darker8.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/fewer/memorial_output_local_middle8.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/fewer/memorial_output_local_lighter8.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	</table>

	<table border="1pt" style="float: center; text-align: center;" >
	<tr>
	<td>Use All Images</td>
	<td>Use 1/2 Images</td>
	<td>Use 1/4 Images</td>
	</tr>
	<tr>
	<td><img src="images/a3_images/local/table_output_local.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/fewer/table_output_local_fewer7.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/fewer/table_output_local_fewer4.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	<tr>
	<td>Use Darker 1/2 Images</td>
	<td>Use Middle 1/2 Images</td>
	<td>Use Brighter 1/4 Images</td>
	</tr>
	<tr>
	<td><img src="images/a3_images/fewer/table_output_local_darker7.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/fewer/table_output_local_middle7.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/fewer/table_output_local_lighter7.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	</table>

</div></div>
<div  class="post" style=" border-bottom:none">
	<h1 class="title" id="local2">Local Tone Mapping II</h1>
	<div class="content">
	<p style="text-align:justify" >Actually, we also implement another local tone mapping algorithm, referring to [Recovering High Dynamic Range Radiance Maps from Photographs], which atteunes the gradients for each pixel to compress the intensity for whole image so that the radiance value can be mapped to a smaller interval, i.e. [0, 255]. Basically, it creates a Gaussian pyramid for the radiance values to keep the ridges information and atteune largely for pixels with larger gradients but relatively slightly for pixels with smaller gradients. However, we didn't obtain quite satisfying results by this method, due to not good enough implementation. </p>
	<table border="1pt" style="float: center; text-align: center;" >
	<tr>
	<td>Compressed Intensity</td>
	<td>Local Tone Mapping II Result</td>
	</tr>
	<tr>
	<td><img src="images/a3_images/local2/belg_I.png" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/local2/belg_output_local2.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	<tr>
	<td><img src="images/a3_images/local2/29_I.png" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/local2/29_output_local2.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	<tr>
	<td><img src="images/a3_images/local2/table_I.png" alt="" class="photo" style="width: 90%; height: auto" /></td>
	<td><img src="images/a3_images/local2/table_output_local2.jpg" alt="" class="photo" style="width: 90%; height: auto" /></td>
	</tr>
	</table>

</div></div>
<div  class="post" style=" border-bottom:none">
	<h1 class="title" id="efficiency">Efficiency</h1>
	<div class="content">
	<p style="text-align:justify"> Both of global tone mapping and local tone mapping are pretty fast. The running time for whole process is around 2 seconds, varying with the actual size of images and the number of images as well as some paramters in code. Actually, here we use matrix to complete many computations, which accelerates the program quite a lot. Previouly, intead of using matrix, using for-loop to calculate, the running time is roughly around 40 seconds, most of which are spent on calculating the real radiance values for all pixels. But for local tone mapping II, it's slower, costing us around 50 seconds or even longer.</p>

</div></div>

</div>
<div id="sidebar">
<div id="menu">
<ul id="updates">
<li><a></a></li>
<li><a href="index.html" title="">Home</a></li>
<li><a href="#objective" title="">Objective</a></li>
<li><a href="#radiance" title="">Radiance Map Construction</a></li>
<li><a href="#global" title="">Global Tone Mapping</a></li>
<li><a href="#local" title="">Local Tone Mapping</a></li>
<li><a href="#intensity" title="">Intensity Calculation</a></li>
<li><a href="#number" title="">Using Different Number of Images</a></li>
<li><a href="#local2" title="">Local Tone Mapping II</a></li>
<li><a href="#efficiency" title="">Efficiency</a></li>
</ul>
</div>
</div>
<div style="clear: both;">&nbsp;</div>
</div>
<div id="footer">
</div>
</body></html>